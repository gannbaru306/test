# スキルタグ仕様（弾幕×ローグライク）

# 全てgannbaru306が書いたので間違ってる場所や重複、意味わからん場所あります。あと直した方が良いことはプロジェクトのコメントに書いて欲しいです。

## 基本構造
```
スキル名|T|R|C|E|I
```

- **T（タイプ）:** A（アクティブ） / P（パッシブ） / O（オーバースキル）
- **R（レア度）:** C / U / R / E / L
- **C（コスト）:** Sxx（SP消費） / Oxx（OP消費）
- **E（効果タグ群）:** カンマ区切りで複数記述
- **I（演出タグ）:** 任意。短い識別子で指定
> パッシブ（P）が含まれている場合、記述された Sxx は「最大SP消費」に自動切り替えされます（Sxx の記述自体は必須）。


---

## 効果タグ一覧（E）

#### 攻撃・命中
- **固定威力:** `25K`
- **階層依存威力:** `20H`（20 × 階層）
- **攻撃力依存威力** `A2`（攻撃力*2）
- **命中率:** `M80`（80%）
- **必中:** `U`

#### 強化（自己強化）
- **攻撃バフ:** `B2`（攻撃2倍）
- **防御バフ:** `D2`（防御2倍）
- **クリティカル率:** `C5`（+5%）
- **持続ターン:** `3t`（3ターン）、`∞t`（永続）

#### 状態異常付与（敵対象）
- Z種類,命中,持続
- **一般構文:** `Z毒,70,3t`（毒・命中70%・3ターン）
- **種類一覧:**
  - **毒:** 毎ターンダメージ → `Z毒,命中,持続`
  - **眠:** 行動不能 → `Z眠,命中,持続`
  - **混:** 混乱 → `Z混,命中,持続`
  - **暗:** 命中低下 → `Z暗,命中,持続`
  - **凍:** 行動不能＋防御低下 → `Z凍,命中,持続`
  - **封:** スキル封印 → `Z封,命中,持続`
  - **阻:** 回復阻害 → `Z阻,命中,持続`

#### 特殊（単文字）
- **反撃（カウンター）:** `F`
- **連射（二回攻撃）:** `N`
- **SP回復:** `R`
- **OP増加:** `O`

> 例外的に「確率」が必要な特殊は `Xxx` の拡張形を許可（任意）。  
> 例：連射が50%で発動 → `N50`（省略時は100%）。

---

## 演出タグ（I）の例
- **赤い光束:** `I赤光`
- **氷のエフェクト:** `I氷結`
- **影踏み:** `I影`
- **雷撃:** `I雷`

> 演出は表示用のみ。処理ロジックには関与しない。

---

## サンプルスキル

#### アクティブスキル
```
オーバーショット|A|R|S20|H20,M100,U,C5|I赤光
```

#### パッシブスキル（最大SP消費に自動切替）
```
クリティカルセンス|P|U|S10|C10,T∞|I青光
```

#### オーバースキル
```
オーバーフリーズ|O|E|O80|Z凍,90,2t|I氷結
```

#### 連射＋カウンターの複合
```
シャドウステップ|A|R|S15|N,U,F|I影
```

---

## 説明文の自動生成

#### 生成方針
- **タグ辞書変換:** 各タグを短文に変換して結合
- **数値展開:** `Hxx` は「階層依存の威力xx」、`Mxx` は「命中率xx%」などに展開
- **ルール反映:** タイプPなら末尾に「（最大SPを消費）」を付記

#### 変換テーブル例
- **Kxx:** 固定威力xx
- **Hxx:** 階層依存の威力xx
- **Mxx:** 命中率xx%
- **U:** 必中
- **Bx:** 攻撃x倍
- **Dx:** 防御x倍
- **Cxx:** クリティカル率+xx%
- **Tn t / T∞:** nターン持続 / 永続
- **Z毒,hit,dur:** 敵にhit%の確率でdur毒付与
- **Z眠,hit,dur:** 敵にhit%の確率でdur睡眠付与
- **Z凍,hit,dur:** 敵にhit%の確率でdur凍結付与
- **F:** 被弾時に反撃
- **N / Nxx:** 攻撃が2回発動（xx%で発動）
- **R:** SPを回復
- **O:** OPを増加

#### 生成例

- **入力:** `オーバーショット|A|R|S20|H20,M100,U,C5|I赤光`  
  **説明:** 階層依存の威力20、命中率100%。必中。クリティカル率が5%上昇。

- **入力:** `クリティカルセンス|P|U|S10|C10,T∞|I青光`  
  **説明:** 常時クリティカル率が10%上昇（最大SPを消費）。

- **入力:** `オーバーフリーズ|O|E|O80|Z凍,90,2t|I氷結|`  
  **説明:** 敵に90%の確率で2ターン凍結を付与（OP80消費）。

---

## 実装メモ（適当）

- **パース順序:**
  1. スキル名/タイプ/レア度/コスト/効果/演出 を縦割り
  2. 効果タグはカンマ分割して個別処理
  3. タイプが P ならコスト表示は「最大SP消費」に置き換え

- **安全策:**
  - **未知タグ:** そのまま文字列出力（ログ警告）
  - **数値不足:** デフォルトを適用（命中率が表記なし＝内部デフォルト）

- **表示最適化:**
  - 説明文は「攻撃→命中→特殊→状態異常→持続→コスト」の順に整列

---

## 追加ルール（任意拡張）

- **クリティカル倍率指定:** `Q2`（クリティカル威力2倍）
- **回避率上昇（自己）:** `?20`（回避+20%）ここアルファベット何にしよう
- **次攻撃強化（一時）:** `X2,1t`（1ターン次の攻撃威力2倍）

> 上記は必要になった時点で導入。未使用なら追加しないししたくない。
