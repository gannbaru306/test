<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MusicXML â†’ ãƒ‰ãƒ¬ãƒŸä»˜ãPDFï¼ˆå®Œå…¨ç‰ˆï¼‰</title>
<style>
  body { font-family: sans-serif; background: #f4f6fa; padding: 1em; text-align: center; }
  #scoreContainer { background: #fff; border: 1px solid #ccc; margin: 1em auto; padding: 1em; max-width: 900px; }
  #status { background: #fff; border: 1px solid #ddd; padding: .5em; margin: 1em auto; max-width: 900px; text-align: left; height: 160px; overflow: auto; white-space: pre-line; }
  input, button { padding: .6em 1em; margin: .4em; }
</style>
</head>
<body>
  <h1>ğŸ¼ XML â†’ ãƒ‰ãƒ¬ãƒŸä»˜ãæ¥½è­œï¼ˆA4é«˜ç”»è³ªPDFå¯¾å¿œï¼‰</h1>

  <div>
    <input type="file" id="fileInput" accept=".xml,.musicxml,.mxl" />
    <button id="loadBtn">èª­ã¿è¾¼ã¿</button>
    <button id="pdfBtn">PDFä¿å­˜</button>
  </div>

  <div id="status">åˆæœŸåŒ–ä¸­...</div>
  <div id="scoreContainer"></div>

  <!-- å¿…é ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
  <script src="https://cdn.jsdelivr.net/npm/opensheetmusicdisplay@1.7.6/build/opensheetmusicdisplay.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
(function(){
  const log = msg => {
    const el = document.getElementById("status");
    el.textContent = new Date().toLocaleTimeString() + " â€” " + msg + "\n" + el.textContent;
    console.log(msg);
  };

  const wait = setInterval(() => {
    if (window.opensheetmusicdisplay?.OpenSheetMusicDisplay) {
      clearInterval(wait);
      log("OSMD èª­ã¿è¾¼ã¿å®Œäº†ã€‚åˆæœŸåŒ–é–‹å§‹ã€‚");
      initApp();
    } else log("OSMD å¾…æ©Ÿä¸­...");
  }, 500);

  function toDoremi(step, alter, octave) {
    const base = { C: "ãƒ‰", D: "ãƒ¬", E: "ãƒŸ", F: "ãƒ•ã‚¡", G: "ã‚½", A: "ãƒ©", B: "ã‚·" };
    let name = base[step] || step;
    if (alter === 1) name += "#";
    if (alter === -1) name += "â™­";
    return name + "
