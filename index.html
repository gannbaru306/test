<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>PDFテスト</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body style="font-family:sans-serif;text-align:center;padding:2em">
  <h1>PDFボタン動作テスト</h1>
  <div id="scoreContainer" style="width:600px;height:300px;background:#fff;border:1px solid #ccc;padding:1em;">
    <h2>テスト出力</h2>
    <p>このボタンを押すとPDFがダウンロードされます。</p>
  </div>
  <button id="pdfBtn" style="margin-top:1em;padding:0.5em 1em;">PDFテスト</button>

  <script>
    // Safari 対応の jsPDF 初期化
    window.jsPDF = window.jspdf.jsPDF;

    document.getElementById('pdfBtn').onclick = async () => {
      const el = document.getElementById('scoreContainer');
      try {
        const canvas = await html2canvas(el, {scale:2, useCORS:true});
        const imgData = canvas.toDataURL('image/png');
        const pdf = new jsPDF();
        const pdfWidth = pdf.internal.pageSize.getWidth();
        const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
        pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
        pdf.save('test.pdf');
      } catch (e) {
        alert('エラー: ' + e.message);
        console.error(e);
      }
    };
  </script>
</body>
</html>
